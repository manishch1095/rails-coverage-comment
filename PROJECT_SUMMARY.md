# Rails Coverage Comment - Project Summary

## Overview

This project is a GitHub Action that automatically comments on pull requests with code coverage reports generated by SimpleCov in Rails applications. It's inspired by the [pytest-coverage-comment](https://github.com/MishaKav/pytest-coverage-comment) action but specifically designed for Rails projects.

## What Was Created

### 1. Core Action Files
- **`action.yml`** - GitHub Action configuration with all inputs and outputs
- **`package.json`** - Node.js project configuration with dependencies
- **`src/index.js`** - Main action entry point that orchestrates everything
- **`src/parse.js`** - SimpleCov HTML coverage report parser
- **`src/parseXml.js`** - SimpleCov XML coverage report parser
- **`src/testResults.js`** - Test results parser (JUnit, RSpec formats)
- **`src/utils.js`** - Utility functions for file operations and formatting
- **`src/multiFiles.js`** - Support for multiple coverage reports

### 2. Documentation
- **`README.md`** - Comprehensive documentation with examples
- **`CHANGELOG.md`** - Version history and changes
- **`LICENSE`** - MIT license
- **`PROJECT_SUMMARY.md`** - This summary document

### 3. Example Files
- **`examples/rails-rspec-workflow.yml`** - Example workflow for RSpec
- **`examples/rails-minitest-workflow.yml`** - Example workflow for Minitest

### 4. Testing Infrastructure
- **`.github/workflows/test.yml`** - GitHub workflow to test the action
- **`test-data/`** - Sample coverage and test result files for testing

### 5. Build Output
- **`dist/index.js`** - Compiled single-file action (generated by `npm run build`)

## Key Features

### Coverage Report Features
- **Coverage Badge**: Color-coded percentage badge (red to brightgreen)
- **File-by-File Breakdown**: Detailed table showing coverage for each file
- **Direct File Links**: Clickable links to source files in the repository
- **Missing Lines**: Shows which lines are not covered (when using XML format)
- **Folder Grouping**: Groups files by folders for better organization

### Test Results Features
- **Test Summary**: Shows total tests, failures, errors, skipped, and time
- **Multiple Formats**: Supports JUnit and RSpec XML formats
- **Detailed Test Info**: Provides information about failed/skipped tests

### Advanced Features
- **Changed Files Only**: Option to show coverage only for files changed in the PR
- **Comment Updates**: Updates existing comments instead of creating new ones
- **Multiple Reports**: Support for monorepos with multiple coverage reports
- **Output Variables**: Provides coverage data as workflow outputs
- **Customizable**: Many options for titles, badges, and display preferences

## Technical Architecture

### File Structure
```
rails-coverage-comment/
├── src/                    # Source code
│   ├── index.js           # Main entry point
│   ├── parse.js           # HTML coverage parser
│   ├── parseXml.js        # XML coverage parser
│   ├── testResults.js     # Test results parser
│   ├── utils.js           # Utility functions
│   └── multiFiles.js      # Multiple reports support
├── dist/                  # Built action (generated)
├── examples/              # Example workflows
├── test-data/             # Test data
├── .github/workflows/     # GitHub workflows
├── action.yml             # Action configuration
├── package.json           # Dependencies
└── README.md              # Documentation
```

### Dependencies
- **@actions/core**: GitHub Actions core utilities
- **@actions/github**: GitHub API client
- **xml2js**: XML parsing for coverage and test results
- **@vercel/ncc**: Single-file compilation

### Build Process
1. Source code is written in Node.js
2. Compiled to single file using `@vercel/ncc`
3. Dependencies are bundled into the final `dist/index.js`
4. Action is ready to be published to GitHub Marketplace

## Usage Examples

### Basic Usage
```yaml
- name: Rails coverage comment
  uses: manishchauhan/rails-coverage-comment@main
  with:
    coverage-path: ./coverage/index.html
    test-results-path: ./test-results.xml
```

### Advanced Usage
```yaml
- name: Rails coverage comment
  uses: manishchauhan/rails-coverage-comment@main
  with:
    coverage-xml-path: ./coverage/coverage.xml
    test-results-path: ./test-results.xml
    title: 'API Coverage Report'
    badge-title: 'API Coverage'
    report-only-changed-files: true
    hide-badge: false
    hide-report: false
```

## Comparison with pytest-coverage-comment

| Feature | pytest-coverage-comment | rails-coverage-comment |
|---------|------------------------|------------------------|
| Language | Python | Ruby/Rails |
| Coverage Tool | pytest-cov | SimpleCov |
| Coverage Formats | Text, XML | HTML, XML |
| Test Formats | JUnit XML | JUnit XML, RSpec XML |
| File Links | ✅ | ✅ |
| Missing Lines | ✅ | ✅ (XML only) |
| Changed Files Only | ✅ | ✅ |
| Multiple Reports | ✅ | ✅ |
| Comment Updates | ✅ | ✅ |
| Output Variables | ✅ | ✅ |

## Next Steps

1. **Publish to GitHub Marketplace**: Make the action available for public use
2. **Add More Test Formats**: Support for other test frameworks
3. **Enhanced Parsing**: Better SimpleCov HTML parsing with more details
4. **Custom Badges**: Allow custom badge styles and colors
5. **Coverage Thresholds**: Fail builds if coverage drops below threshold
6. **Historical Tracking**: Track coverage changes over time

## Benefits for Rails Developers

1. **Automated Coverage Reports**: No need to manually check coverage
2. **PR Integration**: Coverage information directly in pull requests
3. **Team Visibility**: Everyone can see coverage impact of changes
4. **Quality Assurance**: Helps maintain code quality standards
5. **Easy Setup**: Simple configuration with existing SimpleCov setup
6. **Flexible**: Works with RSpec, Minitest, and other test frameworks

This project provides a comprehensive solution for Rails teams to automatically track and display code coverage in their GitHub workflows, making it easier to maintain high code quality standards. 